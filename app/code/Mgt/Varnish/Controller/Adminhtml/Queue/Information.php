<?php
 namespace Mgt\Varnish\Controller\Adminhtml\Queue; class Information extends \Magento\Backend\App\Action { const SQL_LIMIT_URL_QUEUE = 500; protected $jsonHelper; protected $storeManager; protected $urlQueueCollection; public function __construct(\Magento\Backend\App\Action\Context $context, \Magento\Framework\Json\Helper\Data $jsonHelper, \Magento\Store\Model\StoreManagerInterface $storeManager, \Mgt\Varnish\Model\ResourceModel\UrlQueue\Collection $urlQueueCollection) { goto Fd916; Fd916: parent::__construct($context); goto a8336; E294e: $this->storeManager = $storeManager; goto Fdafe; a8336: $this->jsonHelper = $jsonHelper; goto Dea74; Dea74: $this->urlQueueCollection = $urlQueueCollection; goto E294e; Fdafe: } public function execute() { goto B37fa; B37fa: $numberOfUrls = $this->urlQueueCollection->getSize(); goto c7aab; Dd29b: $response->representJson($this->jsonHelper->jsonEncode($data)); goto Eed47; D3a7f: $response = $this->getResponse(); goto Dd29b; c7aab: $urlsInQueue = $this->getUrlsFromQueue(); goto Bdbf4; Bdbf4: $data = ["\156\x75\155\142\x65\162\x4f\146\x55\162\x6c\163" => $numberOfUrls, "\x63\157\x6e\x74\145\x6e\x74" => implode("\x3c\x62\x72\x3e", $urlsInQueue)]; goto D3a7f; Eed47: return $response; goto f5278; f5278: } public function getUrlsFromQueue() { goto dcec1; Faf5e: foreach ($this->urlQueueCollection as $url) { goto B6de7; E14e2: $store = $this->storeManager->getStore($storeId); goto Ec14e; B6de7: $storeId = $url->getStoreId(); goto E14e2; a8ec9: ff25a: goto A0e03; a5951: $urls[] = $url; goto a8ec9; Ec14e: $url = sprintf("\x25\163\x2f\x25\163", rtrim($store->getBaseUrl(), "\x2f"), ltrim($url->getPath(), "\57")); goto a5951; A0e03: } goto d024e; dcec1: $urls = []; goto Cbf03; Cbf03: $this->urlQueueCollection->addOrder("\x70\162\x69\157\162\x69\164\x79"); goto e3d58; d1215: $this->urlQueueCollection->load(); goto Faf5e; F0ba8: return $urls; goto C8402; d024e: B12f6: goto F0ba8; e3d58: $this->urlQueueCollection->setPageSize(self::SQL_LIMIT_URL_QUEUE); goto d1215; C8402: } }
