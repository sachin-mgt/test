<?php
 namespace Mgt\Varnish\Controller\Api; class PurgeUrl extends \Magento\Framework\App\Action\Action { protected $cachePurger; protected $config; public function __construct(\Magento\Framework\App\Action\Context $context, \Magento\CacheInvalidate\Model\PurgeCache $cachePurger, \Mgt\Varnish\Model\Cache\Config $config) { goto fa5e7; fa5e7: $this->cachePurger = $cachePurger; goto b4238; b4238: $this->config = $config; goto Ce283; Ce283: parent::__construct($context); goto fbc96; fbc96: } public function execute() { goto e1ae0; E1d3b: $secretKey = $request->getParam("\163\145\x63\162\145\x74\x4b\x65\171"); goto ef9be; C53e5: if (!($secretKey && $url)) { goto Da2fa; } goto A16c5; d47a5: $response->sendResponse(); goto b0998; A16c5: try { goto ee315; C5764: $this->cachePurger->purgeUrlRequest($url); goto C71d1; ee315: $apiSecretKey = $this->config->getApiSecretKey(); goto Bb8a7; Bb8a7: if (!($secretKey != $apiSecretKey)) { goto df279; } goto Ddf4d; a7b15: df279: goto C5764; C71d1: $body = ["\163\165\x63\143\x65\x73\163" => 1, "\x6d\x65\163\x73\x61\147\145" => sprintf("\124\x68\x65\40\x55\122\x4c\40\x22\x25\163\42\x20\150\x61\x73\x20\x62\145\145\156\x20\x70\165\x72\x67\145\144\x2e", $url)]; goto D8148; Ddf4d: throw new \Exception("\x53\145\143\x72\145\x74\x20\141\x70\151\x20\x6b\x65\x79\40\x69\x73\40\156\x6f\x74\40\143\157\x72\x72\145\143\x74"); goto a7b15; D8148: } catch (\Exception $e) { $errorMessage = $e->getMessage(); $body = ["\x73\x75\143\x63\145\x73\x73" => 0, "\x6d\x65\x73\163\141\x67\145" => $errorMessage]; } goto b650c; Dbf8f: $body = json_encode($body); goto e8aeb; e8aeb: $response->setHeader("\x43\x6f\x6e\x74\x65\156\164\x2d\x54\171\x70\145", "\x61\160\x70\x6c\151\x63\141\164\151\157\x6e\x2f\x6a\x73\x6f\x6e"); goto D8ff2; cdd45: $response = $this->getResponse(); goto Fc61b; e1ae0: $request = $this->getRequest(); goto cdd45; D8ff2: $response->setBody($body); goto d47a5; b650c: Da2fa: goto Dbf8f; ef9be: $url = $request->getParam("\165\x72\x6c"); goto C53e5; b0998: exit; goto eb173; Fc61b: $body = []; goto E1d3b; eb173: } }
