<?php
 namespace Mgt\Varnish\Model\Observer; use Magento\Framework\Event\ObserverInterface; use Magento\Framework\Event\Observer; class SaveConfigObserver implements ObserverInterface { const FULL_PAGE_CACHE_STATUS_ENABLED = 1; const FULL_PAGE_CACHE_STATUS_DISABLED = 0; protected $config; protected $deploymentConfigWriter; protected $configValueFactory; protected $cachePurger; protected $cacheTypeList; public function __construct(\Mgt\Varnish\Model\Cache\Config $config, \Magento\Framework\App\DeploymentConfig\Writer $deploymentConfigWriter, \Magento\Framework\App\Config\ValueFactory $configValueFactory, \Magento\CacheInvalidate\Model\PurgeCache $cachePurger, \Magento\Framework\App\Cache\TypeListInterface $cacheTypeList) { goto Eca58; Da88c: $this->deploymentConfigWriter = $deploymentConfigWriter; goto a1570; B0e12: $this->cachePurger = $cachePurger; goto c419b; c419b: $this->cacheTypeList = $cacheTypeList; goto E1aa2; a1570: $this->configValueFactory = $configValueFactory; goto B0e12; Eca58: $this->config = $config; goto Da88c; E1aa2: } public function execute(Observer $observer) { $isVarnishEnabled = $this->config->isEnabled(); try { goto F2d17; F2d17: $configValue = $this->configValueFactory->create(); goto A4ae2; A4ae2: $configValue->load(\Magento\PageCache\Model\Config::XML_PAGECACHE_TYPE, "\160\x61\164\150"); goto c7195; Ca0e4: B3843: goto D3cf9; d3100: $cacheTypes["\x66\165\x6c\154\x5f\x70\141\147\145"]->setStatus(self::FULL_PAGE_CACHE_STATUS_ENABLED); goto Ce4ff; C3d83: if (!isset($cacheTypes["\x66\165\154\x6c\x5f\x70\141\x67\145"])) { goto b187f; } goto d3100; Addf3: $this->cachePurger->sendPurgeRequest("\x2a"); goto fe17c; Ce4ff: b187f: goto f7aa7; f7aa7: Df259: goto d5175; D3cf9: if (!isset($cacheTypes["\146\165\x6c\x6c\137\160\x61\147\145"])) { goto f876c; } goto D519f; b0fc5: $configValue->setValue(\Magento\PageCache\Model\Config::VARNISH); goto D2b52; d5175: $appEnvDataCacheTypes = []; goto E6c77; D519f: $cacheTypes["\x66\165\154\x6c\x5f\x70\x61\x67\x65"]->setStatus(self::FULL_PAGE_CACHE_STATUS_DISABLED); goto ffa00; d9cd1: da738: goto Ddbf6; E6c77: if (!$cacheTypes) { goto d3fb3; } goto e27b4; A7c2d: if (true === $isVarnishEnabled) { goto C6aba; } goto C0f69; Ddbf6: d3fb3: goto Fcd4d; F6439: $configValue->delete(); goto Ca0e4; C0f69: if (!$configValue->getId()) { goto B3843; } goto F6439; e27b4: foreach ($cacheTypes as $cacheTypeKey => $cacheType) { $appEnvDataCacheTypes["\141\x70\160\137\145\156\x76"]["\x63\x61\143\150\145\x5f\x74\171\160\145\x73"][$cacheTypeKey] = (int) $cacheType->getStatus(); ec9b3: } goto d9cd1; c7195: $cacheTypes = $this->cacheTypeList->getTypes(); goto A7c2d; D2b52: $configValue->save(); goto C3d83; e7299: $configValue->setPath(\Magento\PageCache\Model\Config::XML_PAGECACHE_TYPE); goto b0fc5; Ae8b1: C6aba: goto e7299; ffa00: f876c: goto Addf3; Fcd4d: $this->deploymentConfigWriter->saveConfig($appEnvDataCacheTypes, true); goto ac8d5; fe17c: goto Df259; goto Ae8b1; ac8d5: } catch (\Exception $e) { throw new $e(); } } }
