<?php
 namespace Mgt\Varnish\Model\Observer; use Magento\Framework\Event\ObserverInterface; class ProductSaveAfterObserver implements ObserverInterface { protected $config; protected $productUrlRewriteGenerator; protected $catalogProductTypeConfigurable; protected $productFactory; protected $varnishConfig; protected $urlQueue; protected static $isQueued = false; public function __construct(\Magento\PageCache\Model\Config $config, \Magento\CatalogUrlRewrite\Model\ProductUrlRewriteGenerator $productUrlRewriteGenerator, \Magento\ConfigurableProduct\Model\ResourceModel\Product\Type\Configurable $catalogProductTypeConfigurable, \Magento\Catalog\Model\ProductFactory $productFactory, \Mgt\Varnish\Model\UrlQueue $urlQueue, \Mgt\Varnish\Model\Cache\Config $varnishConfig) { goto a2eca; Ec23f: $this->catalogProductTypeConfigurable = $catalogProductTypeConfigurable; goto fe740; fe740: $this->productFactory = $productFactory; goto E9b8a; a2eca: $this->config = $config; goto C6629; E9b8a: $this->urlQueue = $urlQueue; goto D8549; D8549: $this->varnishConfig = $varnishConfig; goto ebfc4; C6629: $this->productUrlRewriteGenerator = $productUrlRewriteGenerator; goto Ec23f; ebfc4: } public function execute(\Magento\Framework\Event\Observer $observer) { goto B7195; a548f: D90f0: goto cb2ab; Ee26b: $parentProductIds = $this->catalogProductTypeConfigurable->getParentIdsByChild($productId); goto a67fe; C9847: $productId = $product->getId(); goto Ee26b; E20cb: if (false === empty($productUrls)) { goto Cecf8; } goto C9847; D44f0: $productUrls = $this->productUrlRewriteGenerator->generate($product); goto F5396; C542c: Cecf8: goto ea59e; F1ae8: Ccfb9: goto Dafae; F350b: try { $this->urlQueue->addToQueue($urls); } catch (\Exception $e) { } goto a548f; e8693: if (!(true === $isCacheWarmerEnabled && isset($product) && $product instanceof \Magento\Catalog\Model\Product)) { goto d8904; } goto D44f0; a67fe: if (!count($parentProductIds)) { goto a68fd; } goto b7513; e7f08: goto A2425; goto C542c; cb2ab: d8904: goto E7b95; b7513: foreach ($parentProductIds as $parentProductId) { goto dc0b9; Bb6ac: Ad25f: goto D2103; dc0b9: $product = $this->productFactory->create(); goto cf678; cf678: $product->load($parentProductId); goto Ae97d; D2103: C7c99: goto B7bd4; C7f65: foreach ($productUrls as $url) { $urls[] = ["\163\164\157\162\x65\x5f\x69\144" => $url->getStoreId(), "\x70\x61\164\x68" => $url->getRequestPath(), "\x70\162\x69\157\x72\151\164\x79" => \Mgt\Varnish\Model\UrlQueue::PRIORITY_HIGH]; eb797: } goto Bb6ac; Ae97d: $productUrls = $this->productUrlRewriteGenerator->generate($product); goto C7f65; B7bd4: } goto dd17b; F5396: $urls = []; goto E20cb; dd17b: aabb6: goto B5549; Dafae: A2425: goto c4d26; D6d13: $isCacheWarmerEnabled = $this->varnishConfig->isCacheWarmerEnabled(); goto e8693; c4d26: if (!count($urls)) { goto D90f0; } goto F350b; B5549: a68fd: goto e7f08; ea59e: foreach ($productUrls as $url) { $urls[] = ["\163\x74\157\162\145\137\x69\144" => $url->getStoreId(), "\x70\x61\164\150" => $url->getRequestPath(), "\x70\162\x69\x6f\x72\x69\164\171" => \Mgt\Varnish\Model\UrlQueue::PRIORITY_HIGH]; b9354: } goto F1ae8; B7195: $product = $observer->getEvent()->getProduct(); goto D6d13; E7b95: } }
